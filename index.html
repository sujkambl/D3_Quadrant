<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
svg{
  shape-rendering: geometricPrecision; 
}
  
.spacer{
  padding-top: 20px;
}
    
.spacerbig{
  padding-top: 40px;
}

</style>  
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<body>

<div class="container">
<div class="row" style="padding-top: 20px;">
          
          <div class="col-md-9"><div id="svgcontainer"></div></div>
          <div class="col-md-3">
            <label for="selectx">Geography</label><br />
            <select class="varselect" id="selectgeo"><option>Colorado Counties</option></select>            
            <div class="spacerbig"></div>            
            <label for="selectx">X Values</label>
            <select class="varselect" id="selectx"></select>
            <div class="spacer"></div>
             <label for="selectx">Y Values</label>
            <select class="varselect" id="selecty"></select> 
            <div class="spacer"></div>            
             <label for="selectx">Z Values</label>
            <select class="varselect" id="selectz"></select>   
            <div class="spacer"></div>   
            <button type="button" onclick="submitbtn();">Submit</button>
            <hr>
  </div>
          
</div>
</div>
  
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
      <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="../CensusAPI_Map/assets/js/datatree.js"></script>
<script>



var data = [
{x:88.8893474761649,y:96.83224361339,z:468688,label:'Adams', category:'3'},
{x:68.6353818426954,y:92.3274245106357,z:15805,label:'Alamosa', category:'8'},
{x:101.323482878644,y:98.724988112527,z:606603,label:'Arapahoe', category:'3'},
{x:80.0996051563553,y:90.7128277200863,z:12168,label:'Archuleta', category:'9'},
{x:66.1466286956402,y:83.0526846833904,z:3669,label:'Baca', category:'6'},
{x:58.6047023539285,y:84.5160978596602,z:5674,label:'Bent', category:'6'},
{x:127.487721325684,y:105.388092614466,z:309874,label:'Boulder', category:'3'},
{x:133.155860057507,y:103.993890020367,z:59450,label:'Broomfield', category:'3'},
{x:82.0380535721656,y:96.372900500271,z:18282,label:'Chaffee', category:'13'},
{x:87.9634597658453,y:85.4492402130849,z:1887,label:'Cheyenne', category:'5'},
{x:123.244871847786,y:101.729120605985,z:9029,label:'Clear Creek', category:'3'},
{x:60.9985279348439,y:85.2076681478301,z:8228,label:'Conejos', category:'8'},
{x:57.1642797198949,y:88.6683941533608,z:3506,label:'Costilla', category:'8'},
{x:56.7776906461953,y:84.4134389428472,z:5225,label:'Crowley', category:'6'},
{x:68.7880914056159,y:94.3910353281347,z:4295,label:'Custer', category:'13'},
{x:70.9053888590807,y:94.733194175395,z:30299,label:'Delta', category:'10'},
{x:87.6429072598952,y:109.566187536091,z:648937,label:'Denver', category:'3'},
{x:71.3676448333265,y:89.4969418164291,z:2012,label:'Dolores', category:'9'},
{x:155.364783248724,y:101.266798830223,z:306033,label:'Douglas', category:'3'},
{x:118.545269442954,y:109.796330094069,z:52338,label:'Eagle', category:'12'},
{x:123.341175175754,y:96.5903436140707,z:23679,label:'Elbert', category:'5'},
{x:97.304882578728,y:98.6352566533312,z:655812,label:'El Paso', category:'4'},
{x:66.8936673683052,y:92.1877452371283,z:46260,label:'Fremont', category:'13'},
{x:92.0948725356666,y:102.951251258918,z:57298,label:'Garfield', category:'11'},
{x:120.570390853935,y:96.2362491115743,z:5589,label:'Gilpin', category:'3'},
{x:102.381443724462,y:105.94659010925,z:14287,label:'Grand', category:'12'},
{x:92.2407032894465,y:102.545821187839,z:15454,label:'Gunnison', category:'10'},
{x:104.557898936536,y:103.932786515126,z:805,label:'Hinsdale', category:'10'},
{x:57.5921416484378,y:87.51619073138,z:6467,label:'Huerfano', category:'14'},
{x:83.5280036320112,y:91.3116057027918,z:1353,label:'Jackson', category:'12'},
{x:116.880597630938,y:102.050912855195,z:552213,label:'Jefferson', category:'3'},
{x:76.9573651409468,y:82.3594054704967,z:1401,label:'Kiowa', category:'6'},
{x:79.1585840659265,y:90.6969705390269,z:8052,label:'Kit Carson', category:'5'},
{x:78.7857526105081,y:101.313642005741,z:7308,label:'Lake', category:'13'},
{x:93.1831001417035,y:103.11840229364,z:53446,label:'La Plata', category:'9'},
{x:104.82479673119,y:98.4207720307789,z:315728,label:'Larimer', category:'2'},
{x:73.0378196926548,y:88.050443199134,z:14361,label:'Las Animas', category:'14'},
{x:71.3676448333265,y:87.3299321052859,z:5420,label:'Lincoln', category:'5'},
{x:68.7880914056159,y:92.7060756161623,z:21858,label:'Logan', category:'1'},
{x:83.280366502951,y:93.653554562575,z:147811,label:'Mesa', category:'11'},
{x:94.1543879923508,y:98.2118091225416,z:721,label:'Mineral', category:'8'},
{x:94.6826805343459,y:97.5030515103595,z:13090,label:'Moffat', category:'11'},
{x:67.7493912253911,y:92.6343781654606,z:25650,label:'Montezuma', category:'9'},
{x:76.8335465764167,y:92.842599321027,z:40754,label:'Montrose', category:'10'},
{x:69.0659952948945,y:94.9171316857873,z:28311,label:'Morgan', category:'1'},
{x:57.7035783565149,y:85.5426549091641,z:18549,label:'Otero', category:'6'},
{x:99.3699010827246,y:101.519797671058,z:4529,label:'Ouray', category:'10'},
{x:104.70097816666,y:100.029921442812,z:16192,label:'Park', category:'4'},
{x:75.0932078638546,y:89.0424380421359,z:4346,label:'Phillips', category:'1'},
{x:61.195261876264,y:83.8922759180377,z:12236,label:'Prowers', category:'6'},
{x:72.5095271506597,y:93.1034195383797,z:161258,label:'Pueblo', category:'7'},
{x:104.527632176318,y:93.5413200448563,z:6778,label:'Rio Blanco', category:'11'},
{x:62.3866716194092,y:92.5026629771151,z:11736,label:'Rio Grande', category:'8'},
{x:102.575426142226,y:110.612378395165,z:23400,label:'Routt', category:'11'},
{x:56.6181022741343,y:87.586494644247,z:6231,label:'Saguache', category:'8'},
{x:73.1822746846066,y:100.197552432534,z:687,label:'San Juan', category:'9'},
{x:106.907700138952,y:110.515766968954,z:7658,label:'San Miguel', category:'10'},
{x:73.603257804009,y:87.1103280295653,z:2340,label:'Sedgwick', category:'1'},
{x:109.26300438868,y:121.985739027718,z:28637,label:'Summit', category:'12'},
{x:100.952027185054,y:96.7182144794295,z:23278,label:'Teller', category:'4'},
{x:76.5006122140135,y:87.2595456807304,z:4772,label:'Washington', category:'1'},
{x:91.9559205910273,y:93.7244067739753,z:269643,label:'Weld', category:'2'},
{x:73.6060093276652,y:87.1064786861444,z:10114,label:'Yuma', category:'1'}
];
  
var setup = {
  quadrantxaxis: 100,
  quadrantyaxis: 100,
  title: "Median Family Income by Cost of Living",
  xlabel: "Median Family Income Index",
  ylabel: "Cost of Living Index",
  dotcolor: 'maroon'
} ; 
  

var i;
      
        //loop through - add all themes
       
        for (i = 0; i < datatree.data.length; i=i+1) {
            $('#selectx').append('<option value="' + datatree.data[i].varcode + '">' + datatree.data[i].verbose + '</option>'); 
            $('#selecty').append('<option value="' + datatree.data[i].varcode + '">' + datatree.data[i].verbose + '</option>'); 
            $('#selectz').append('<option value="' + datatree.data[i].varcode + '">' + datatree.data[i].verbose + '</option>'); 
        }
  
  

  

    function submitbtn(){
      
      $( "svg" ).remove();
              
      var newsetuparray={};
      
    var tablelist='';
      
    var geog='cc';  //future - only working on Colorado Counties right now
      
    var xval=$("#selectx").val(); 
    var yval=$("#selecty").val();
    var zval=$("#selectz").val();  
         
    var db='acs0913';
    var schema='data';
    var limit='10000';
      
      var sumlev="50";
      var state="8";
      
      var fp;
      var xnumerator;
      var xdenominator;
      var ynumerator;
      var ydenominator;
      var znumerator;
      var zdenominator;
      
    for(i=0;i<datatree.data.length;i=i+1){
        if(xval==datatree.data[i].varcode){
          fp=datatree.data[i];
          tablelist=fp.table;
          newsetuparray.xlabel=fp.verbose;
         xnumerator=fp.numerator;
         xdenominator=fp.denominator;       
        }
      
    }     
    for(i=0;i<datatree.data.length;i=i+1){
        if(yval==datatree.data[i].varcode){
          fp=datatree.data[i];
          tablelist=tablelist+","+fp.table;
          newsetuparray.ylabel=fp.verbose;
         ynumerator=fp.numerator;
         ydenominator=fp.denominator;      
        }
    }
    
      if(zval!=='none'){
        for(i=0;i<datatree.data.length;i=i+1){
          fp=datatree.data[i];
          if(zval==datatree.data[i].varcode){
            tablelist=tablelist+","+fp.table;
             znumerator=fp.numerator;
             zdenominator=fp.denominator;      
          }
          }           
        }
      

    newsetuparray.title=newsetuparray.xlabel + ' by ' + newsetuparray.ylabel ;

//first call query for CO AVG - encapsulate main call

    $.get( "../CensusAPI/demog.php?db="+db+"&schema="+schema+"&table="+tablelist+"&geonum=108", function( prelim ) {

      //get state avg data
          fp=prelim.data[0];       

          newsetuparray.quadrantxaxis=((eval(xnumerator))/(eval(xdenominator)));  
          newsetuparray.quadrantyaxis=((eval(ynumerator))/(eval(ydenominator)));    

      $.get( "../CensusAPI/demog.php?db="+db+"&schema="+schema+"&limit="+limit+"&table="+tablelist+"&sumlev="+sumlev+"&state="+state, function( results ) {
      
        //get individual data
        
      //console.log(results);
      
      var newdataarray=[];  
      var tempobj={};
      

      
      for(i=0;i<results.data.length;i=i+1){
          fp=results.data[i];       
          tempobj={};
          tempobj.x=((eval(xnumerator))/(eval(xdenominator)));  
          tempobj.y=((eval(ynumerator))/(eval(ydenominator)));    
          tempobj.z=((eval(znumerator))/(eval(zdenominator)));        
          tempobj.label=fp.geoname.replace(/ County, Colorado/g, "");    
          tempobj.category=lookupregion(tempobj.label);
          newdataarray.push(tempobj);
      }

      
      //console.log(newdataarray);
  
      createQuadrantChart(newdataarray, newsetuparray);
      
    });
      
     });     
      
      function lookupregion(county){

        switch(county){
            case 'Adams': return '3';
          case 'Alamosa': return '8';
            case 'Arapahoe': return '3';
            case 'Archuleta': return '9';
            case 'Baca': return '6';
            case 'Bent': return '6';
            case 'Boulder': return '3';
            case 'Broomfield': return '3';
            case 'Chaffee': return '13';
            case 'Cheyenne': return '5';
            case 'Clear Creek': return '3';
            case 'Conejos': return '8';
            case 'Costilla': return '8';
            case 'Crowley': return '6';
            case 'Custer': return '13';
            case 'Delta': return '10';
            case 'Denver': return '3';
            case 'Dolores': return '9';
            case 'Douglas': return '3';
            case 'Eagle': return '12';
            case 'Elbert': return '5';
            case 'El Paso': return '4';
            case 'Fremont': return '13';
            case 'Garfield': return '11';
            case 'Gilpin': return '3';
            case 'Grand': return '12';
            case 'Gunnison': return '10';
            case 'Hinsdale': return '10';
            case 'Huerfano': return '14';
            case 'Jackson': return '12';
            case 'Jefferson': return '3';
            case 'Kiowa': return '6';
            case 'Kit Carson': return '5';
            case 'Lake': return '13';
            case 'La Plata': return '9';
            case 'Larimer': return '2';
            case 'Las Animas': return '14';
            case 'Lincoln': return '5';
            case 'Logan': return '1';
            case 'Mesa': return '11';
            case 'Mineral': return '8';
            case 'Moffat': return '11';
            case 'Montezuma': return '9';
            case 'Montrose': return '10';
            case 'Morgan': return '1';
            case 'Otero': return '6';
            case 'Ouray': return '10';
            case 'Park': return '4';
            case 'Phillips': return '1';
            case 'Pitkin': return '12';
            case 'Prowers': return '6';
            case 'Pueblo': return '7';
            case 'Rio Blanco': return '11';
            case 'Rio Grande': return '8';
            case 'Routt': return '11';
            case 'Saguache': return '8';
            case 'San Juan': return '9';
            case 'San Miguel': return '10';
            case 'Sedgwick': return '1';
            case 'Summit': return '12';
            case 'Teller': return '4';
            case 'Washington': return '1';
            case 'Weld': return '2';
            case 'Yuma': return '1';
  
  console.log('uh oh - fall through switch');
            
  }

}
      
  //WILL NEED A CROSSWALK FOR THIS
  //
  //categorize by
  //-------------
  // -Population Size
  // -State Region
  // -County Planning Region (Colorado Only)
  // -Watershed
  // -Median Household Income Quantile
      
      
    } //end submitbtn
  

  function createQuadrantChart(data,setup){
  
//Options
var width = setup.width || 800,
    height = setup.height || 600,
    dotRadius = setup.dotRadius || 6, 
    gridSpacing = setup.gridSpacing || 10,
    topspace = setup.topspace || 60,
    lbuffer= setup.lbuffer || 100,
    rbuffer= setup.rbuffer || 40,
    bottomspace= setup.bottomspace || 60,
    title= setup.title || "",
    xlabel= setup.xlabel || "",
    ylabel= setup.ylabel || "",
    quadrantxaxis = setup.quadrantxaxis || 0,
    quadrantyaxis = setup.quadrantyaxis || 0,
    quadrantaxiscolor = setup.quadrantaxiscolor || 'grey',
    quadrantaxiswidth = setup.quadrantaxiswidth || '2px',
    quadrantaxisopacity = setup.quadrantaxisopacity || '0.5',
    dotcolor = setup.dotcolor || 'black',
    svgborderwidth = setup.svgborderwidth || '1px ',
    svgbordercolor = setup.svgbordercolor || ' #ccc',
    gridlinesstroke = setup.gridlinesstroke || 'steelblue', 
    gridlineswidth = setup.gridlineswidth || '0.5px',
    gridlinesopacity = setup.gridlinesopacity || '0.5',
    axislinewidth = setup.axislinewidth || '1px',
    axislinecolor = setup.axislinecolor || 'black',
    axisopacity = setup.axisopacity || '0.5',
    axistextsize = setup.axistextsize || '10px',
    axistextcolor = setup.axistextcolor || 'black',
    item_min_ptsize = setup.item_min_ptsize || 3,
    item_max_ptsize = setup.item_max_ptsize || 8,
    dotstroke = setup.dotstroke || 'none',
    dotstrokewidth = setup.dotstrokewidth || '0px',
    itemslabel = setup.itemslabel || true,
    itemsfontsize = setup.itemsfontsize || '10px',
    itemsfontcolor = setup.itemsfontcolor || 'black',
    titlefontsize = setup.titlefontsize || '24px',
    titlefontcolor = setup.titlefontcolor || 'black',
    axislabelsize = setup.axislabelsize || '20px',
    axislabelcolor = setup.axislabelcolor || 'black'
;  

//min and max data values (for setting up axis)  
var min_x = d3.min(data, function(d) {
  return d.x;
});
var min_y = d3.min(data, function(d) {
  return d.y;
});
var max_x = d3.max(data, function(d) {
  return d.x;
});
var max_y = d3.max(data, function(d) {
  return d.y;
});
  
  
var min_size, max_size, no_z=false, no_category=false, categoryarray=[];
  
//whether or not z-value is given (otherwise default dotRadius)
if(!data[0].z){
  no_z=true;
}else{
// dot size range  
  min_size = d3.min(data, function(d) {
    return d.z;
  });
  max_size = d3.max(data, function(d) {
    return d.z;
  });
  var cscale = d3.scale.linear().domain([min_size,max_size]).range([item_min_ptsize,item_max_ptsize]);
}
    
//whether or not category is given (otherwise default dotcolor)    
if(!data[0].category){
  no_category=true;
}else{
  for(var count=0; count<data.length; count=count+1){
    categoryarray.push(data[count].category);
  }
  
  //remove duplicates function
  function uniq_fast(a) {
    var seen = {};
    var out = [];
    var len = a.length;
    var j = 0;
    for(var i = 0; i < len; i++) {
         var item = a[i];
         if(seen[item] !== 1) {
               seen[item] = 1;
               out[j++] = item;
         }
    }
    return out;
}
  
  var newarray=uniq_fast(categoryarray);
  var c20 = d3.scale.category20();
  
}    
  
//buffer the axis ranges so that points arent on edge of graph  
var buffer_x = (Math.abs(min_x)+Math.abs(max_x))*.01; //1% buffer
var buffer_y = (Math.abs(min_y)+Math.abs(max_y))*.01; //1% buffer  
  
var svg = d3.select("#svgcontainer").append("svg")
    .attr("width",width) //+lbuffer+rbuffer
    .attr("height",height) //+bottomspace+topspace
    .style({'border': svgborderwidth+'solid'+svgbordercolor});

//Scales for item positions
var x = d3.scale.linear().domain([min_x-buffer_x,max_x+buffer_x]).range([lbuffer,(width-rbuffer)]);
var y = d3.scale.linear().domain([min_y-buffer_y,max_y+buffer_y]).range([height-bottomspace,topspace]);


//gridlines
svg.append("path")
  .attr("d",function() {
    var d = "";

    for (var i = lbuffer; i < (width-rbuffer)+gridSpacing; i += gridSpacing ) {
      d += "M"+(i)+","+topspace+" L"+i+","+(height-bottomspace);
    }

    for (var i = topspace; i < (height-bottomspace)+gridSpacing; i += gridSpacing ) {
      d += "M"+lbuffer+","+(i)+" L"+(width-rbuffer)+","+(i);
    }

    return d;
  }).style({'stroke': gridlinesstroke, 'stroke-width': gridlineswidth, 'opacity': gridlinesopacity});


//quadrant axes
svg.append("path")
  .attr("d","M"+lbuffer+","+(((y(quadrantyaxis)))+0)+" L"+(width-rbuffer)+","+(((y(quadrantyaxis)+0))))
  .attr("stroke", quadrantaxiscolor)
  .attr("stroke-width", quadrantaxiswidth)
  .attr('opacity', quadrantaxisopacity)
  .append("svg:title")
   .text(setup.quadrantyaxis);

svg.append("path")
  .attr("d","M"+(x(quadrantxaxis))+","+topspace+" L"+(x(quadrantxaxis))+","+(height-bottomspace))
  .attr("stroke", quadrantaxiscolor)
  .attr("stroke-width", quadrantaxiswidth)
  .attr('opacity', quadrantaxisopacity)
  .append("svg:title")
   .text(setup.quadrantxaxis);
  
  var xAxis = d3.svg.axis().scale(x).orient("bottom"); 
  var yAxis = d3.svg.axis().scale(y).orient("left"); 
 
  var xAxisGroup = svg.append("g") //
    .attr("class", "xaxis")
    .attr("transform", "translate("+0+"," + (height-topspace) + ")")
    .call(xAxis);

      
  xAxisGroup.selectAll('.xaxis line, .xaxis path')
     .style({'stroke': axislinecolor, 'fill': 'none', 'stroke-width': axislinewidth, 'opacity': axisopacity});
  
  xAxisGroup.selectAll('.xaxis text')
     .style({'stroke': axistextcolor, 'font-size': axistextsize, 'opacity': axisopacity});
  
  var yAxisGroup = svg.append("g")
      .attr("class", "yaxis")
      .attr("transform", "translate("+lbuffer+", "+0+")")
      .call(yAxis);
  
  yAxisGroup.selectAll('.yaxis line, .yaxis path')
     .style({'stroke': axislinecolor, 'fill': 'none', 'stroke-width': axislinewidth, 'opacity': axisopacity});  
  
  yAxisGroup.selectAll('.yaxis text')
     .style({'stroke': axistextcolor, 'font-size': axistextsize, 'opacity': axisopacity});
  
  
//One group per item
var items = svg.selectAll("g.item").data(data).enter().append("g");

  
  
//Add a dot
items.append("circle")
  .attr("r", function(d){
  if(no_z){return dotRadius;}else{return cscale(d.z);}
})
  .attr("cx",function(d){
    return x(d.x);
  })
  .attr("cy",function(d){
    return y(d.y);
  })
.style({'fill': function(d){
  if(no_category){
    return dotcolor;
  }else{
    for(var i=0; i<newarray.length; i=i+1){
      if(d.category==newarray[i]){return c20(i);}
    }
  }

}, 'stroke': dotstroke, 'stroke-width': dotstrokewidth})
  .append("svg:title")
   .text(function(d) { return d.label; });



    
if(itemslabel){    

  
var textLabels = items.append("text")
  .attr("x",function(d){
    return x(d.x);
  })
  .attr("y",function(d){
    return y(d.y);
  })
  .attr("dy","1.25em")
  .attr("text-anchor","middle")
  .text(function(d){return d.label;})
.style({'font-size': itemsfontsize, 'fill': itemsfontcolor});
  
}

  //xaxis
svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", ((width-rbuffer-lbuffer)/2)+lbuffer)
    .attr("y", (height - 10))
    .text(setup.xlabel)
.style({'font-size': axislabelsize, 'fill': axislabelcolor});  
  
  //yaxis
svg.append("text")
    .attr("text-anchor", "middle")
    .attr("y", 27)
    .attr("x", -(((height-bottomspace-topspace)/2)+(topspace)))
    .attr("transform", "rotate(-90)")
    .text(setup.ylabel)
  .style({'font-size': axislabelsize, 'fill': axislabelcolor});    
  
  //title
svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", ((width-rbuffer-lbuffer)/2)+lbuffer)
    .attr("y", (topspace/2)+5)
    .text(setup.title)  
  .style({'font-size': titlefontsize, 'fill': titlefontcolor});    
  
  }
  
  

</script>